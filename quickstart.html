<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>快速开始 &#8212; LiberZMQ 1.0.0 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=9a98c4c4" />
    <script src="_static/documentation_options.js?v=34088549"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="架构设计" href="architecture.html" />
    <link rel="prev" title="安装指南" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">LiberZMQ</a></h1>



<p class="blurb">LiberZMQ - 高性能ZeroMQ消息传递库</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=liberalchang&repo=liberzmq&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>导航</h3>
<p class="caption" role="heading"><span class="caption-text">用户指南:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装指南</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">快速开始</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">基本概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">发布-订阅模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">请求-响应模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">推拉模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dealer-router">Dealer/Router模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">配置和序列化</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">下一步</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">架构设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">性能指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">高级用法</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/core.html">核心模块 (liberzmq.core)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/patterns.html">消息模式 (liberzmq.patterns)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serializers.html">序列化器 (liberzmq.serializers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/logging.html">日志模块 (liberzmq.logging)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/exceptions.html">异常处理 (liberzmq.exceptions)</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="上一章">安装指南</a></li>
      <li>Next: <a href="architecture.html" title="下一章">架构设计</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="id1">
<h1>快速开始<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>本指南将帮助您快速上手LiberZMQ的基本功能。</p>
<section id="id2">
<h2>基本概念<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>LiberZMQ提供四种主要的消息模式：</p>
<ul class="simple">
<li><p><strong>发布-订阅 (Pub/Sub)</strong>: 一对多的消息广播</p></li>
<li><p><strong>请求-响应 (Req/Rep)</strong>: 同步的请求-响应通信</p></li>
<li><p><strong>推拉 (Push/Pull)</strong>: 负载均衡的任务分发</p></li>
<li><p><strong>Dealer/Router</strong>: 异步的多对多通信，支持负载均衡和路由</p></li>
</ul>
</section>
<section id="id3">
<h2>发布-订阅模式<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>发布-订阅模式适用于一对多的消息广播场景。</p>
<section id="id4">
<h3>发布者示例<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Publisher</span>

<span class="c1"># 创建发布者</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">)</span>
<span class="n">publisher</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 发布消息</span>
<span class="n">publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;news&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;重要新闻&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;这是一条重要新闻&quot;</span>
<span class="p">})</span>

<span class="n">publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;北京&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">25</span>
<span class="p">})</span>

<span class="n">publisher</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>订阅者示例<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Subscriber</span>

<span class="c1"># 创建订阅者</span>
<span class="n">subscriber</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://localhost:5555&quot;</span><span class="p">)</span>
<span class="n">subscriber</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 定义消息处理函数</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_news</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;收到新闻: </span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">handle_weather</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">的温度: </span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">)</span>

<span class="c1"># 订阅主题</span>
<span class="n">subscriber</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;news&quot;</span><span class="p">,</span> <span class="n">handle_news</span><span class="p">)</span>
<span class="n">subscriber</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="n">handle_weather</span><span class="p">)</span>

<span class="c1"># 开始监听</span>
<span class="n">subscriber</span><span class="o">.</span><span class="n">start_listening</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h2>请求-响应模式<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>请求-响应模式适用于同步的客户端-服务器通信。</p>
<section id="id7">
<h3>服务器示例<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Server</span>

<span class="c1"># 创建服务器</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5556&quot;</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 注册请求处理器</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_handler</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">operation</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;multiply&#39;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;不支持的操作&#39;</span><span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>

<span class="n">server</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="s1">&#39;calculate&#39;</span><span class="p">,</span> <span class="n">calculate_handler</span><span class="p">)</span>

<span class="c1"># 启动服务器</span>
<span class="n">server</span><span class="o">.</span><span class="n">start_server</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3>客户端示例<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

<span class="c1"># 创建客户端</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://localhost:5556&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 发送请求</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="s1">&#39;calculate&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="s1">&#39;add&#39;</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;计算结果: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 输出: 计算结果: 15</span>

<span class="c1"># 使用远程方法调用</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;calculate&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;乘法结果: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 输出: 乘法结果: 60</span>

<span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h2>推拉模式<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<p>推拉模式适用于负载均衡的任务分发场景。</p>
<section id="id10">
<h3>任务分发器示例<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pusher</span>

<span class="c1"># 创建推送器</span>
<span class="n">pusher</span> <span class="o">=</span> <span class="n">Pusher</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5557&quot;</span><span class="p">)</span>
<span class="n">pusher</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 推送任务</span>
<span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;process_image&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;image1.jpg&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;process_image&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;image2.jpg&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;send_email&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="s1">&#39;user@example.com&#39;</span><span class="p">}</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
    <span class="n">pusher</span><span class="o">.</span><span class="n">push_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

<span class="n">pusher</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>工作器示例<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Puller</span>

<span class="c1"># 创建拉取器</span>
<span class="n">puller</span> <span class="o">=</span> <span class="n">Puller</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://localhost:5557&quot;</span><span class="p">)</span>
<span class="n">puller</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 注册任务处理器</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_image_handler</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;处理图片: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;processed_file&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;processed_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_email_handler</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">to</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;发送邮件到: </span><span class="si">{</span><span class="n">to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="n">to</span><span class="p">}</span>

<span class="n">puller</span><span class="o">.</span><span class="n">register_task_handler</span><span class="p">(</span><span class="s1">&#39;process_image&#39;</span><span class="p">,</span> <span class="n">process_image_handler</span><span class="p">)</span>
<span class="n">puller</span><span class="o">.</span><span class="n">register_task_handler</span><span class="p">(</span><span class="s1">&#39;send_email&#39;</span><span class="p">,</span> <span class="n">send_email_handler</span><span class="p">)</span>

<span class="c1"># 启动工作器</span>
<span class="n">puller</span><span class="o">.</span><span class="n">start_worker</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="dealer-router">
<h2>Dealer/Router模式<a class="headerlink" href="#dealer-router" title="Link to this heading">¶</a></h2>
<p>Dealer/Router模式适用于异步的多对多通信场景，支持负载均衡和消息路由。</p>
<section id="router">
<h3>Router服务器示例<a class="headerlink" href="#router" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Router</span>

<span class="c1"># 创建Router服务器</span>
<span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5558&quot;</span><span class="p">)</span>
<span class="n">router</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 处理请求</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 接收请求</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">router</span><span class="o">.</span><span class="n">receive_request</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;收到来自 </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2"> 的请求: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 处理请求并发送响应</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;echo&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
        <span class="n">router</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span> <span class="n">response_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">router</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="dealer">
<h3>Dealer客户端示例<a class="headerlink" href="#dealer" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dealer</span>

<span class="c1"># 创建Dealer客户端</span>
<span class="n">dealer</span> <span class="o">=</span> <span class="n">Dealer</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://localhost:5558&quot;</span><span class="p">)</span>
<span class="n">dealer</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># 发送请求并等待响应</span>
<span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello from Dealer&quot;</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">dealer</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request_data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;收到响应: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 使用回调方式发送异步请求</span>
<span class="k">def</span><span class="w"> </span><span class="nf">response_callback</span><span class="p">(</span><span class="n">response_data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;异步响应: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">dealer</span><span class="o">.</span><span class="n">send_request_async</span><span class="p">(</span><span class="n">request_data</span><span class="p">,</span> <span class="n">response_callback</span><span class="p">)</span>

<span class="c1"># 等待一段时间让异步请求完成</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dealer</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id12">
<h2>配置和序列化<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<section id="id13">
<h3>使用不同的序列化器<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用JSON序列化器（默认）</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>

<span class="c1"># 使用二进制序列化器</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>

<span class="c1"># 使用Protocol Buffers序列化器</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="s1">&#39;protobuf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id14">
<h3>配置日志<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_logging</span>

<span class="c1"># 配置日志</span>
<span class="n">configure_logging</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;liberzmq.log&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3>异常处理<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">TimeoutError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">liberzmq.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;tcp://localhost:5556&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;连接错误: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;请求超时: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id16">
<h2>下一步<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<p>现在您已经了解了LiberZMQ的基本用法，可以继续阅读：</p>
<ul class="simple">
<li><p><a class="reference internal" href="api/core.html"><span class="doc">核心模块 (liberzmq.core)</span></a> - 查看核心模块API文档</p></li>
<li><p><a class="reference internal" href="api/patterns.html"><span class="doc">消息模式 (liberzmq.patterns)</span></a> - 查看消息模式API文档</p></li>
<li><p><a class="reference internal" href="api/serializers.html"><span class="doc">序列化器 (liberzmq.serializers)</span></a> - 查看序列化器API文档</p></li>
<li><p><a class="reference internal" href="api/logging.html"><span class="doc">日志模块 (liberzmq.logging)</span></a> - 查看日志模块API文档</p></li>
<li><p><a class="reference internal" href="api/exceptions.html"><span class="doc">异常处理 (liberzmq.exceptions)</span></a> - 查看异常处理API文档</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, liber.
      
      |
      <a href="_sources/quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/liberalchang/liberzmq" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>